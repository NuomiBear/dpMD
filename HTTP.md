# 1.0 键入网址到网页显示，期间发生了什么？ 

![简单的网络模型](httpxiaolin.webp)

## URL解析  

> 首先浏览器做的第一步工作就是要对 URL 进行解析，从而生成发送给 Web 服务器的请求信息。

<https://www.baidu.com/>  
<https://item.jd.com/100038005193.html>  
<https://detail.tmall.com/item.htm?de_count=1&id=709064714885&skuId=5148947539712> 

一个完整的 URL 分为几个部分
![url 解析](urlxiaolin.webp)

- 协议
  - `HTTP(80)`：超文本传输协议
  - `HTTPS(443)`：基于SSL（Secure Sockets Layer 安全套接层）加密的HTTP传输协议，比HTTP更加安全（涉及支付的网站一般都是基于HTTPS完成的）
  - `FTP(21)`：文件传输协议，一般用来实现资源文件在服务器上的上传下载
- 域名(服务器)
- 端口
  - 用来区分同一台服务器上不同服务的标识（基于WEB服务管理器创建服务的时候可以指定）不同服务之间一般是不能使用相同的端口号的
  - ​如果当前网站服务，采用的是协议对应的默认端口管理，那么当用户输入网址的时候可以不指定端口号，浏览器会默认把用户把默认的端口传递给服务器
  - 一台服务器上的端口号范围：0~65535之间，1023及以下的端口已经分配给了常用的一些应用程序做保留
- 路径
  - `/stu/index.html`：一般都是请求当前服务对应的项目目录中，STU文件夹中的INDEX.HTML页面。但是也有特情况，就是当前的URL是被“伪URL重写”的，我们看到的URL请求其实不是真实的请求（例如 `https://item.jd.com/4679424.html` 这个URL就是被重写的，它的真实URL地址很可能是 `https://item.jd.com/detail.jsp?id=4679424`，其实就是跳转到详情页，通过问号传递不同的产品编号，展示不同的产品详情信息，但是.jsp这种服务器渲染的动态页面不能被搜索引擎收录，不利于页面的SEO，所以我们会把动态页面静态化，这也就用到了URL重写技术）
  - `/stu/info`：这种没有任何后缀信息，一般都不是用来请求资源文件的，而是用于AJAX数据请求的接口地址（如果后缀是.json类的，也是同理），但是有一种除外 /stu/info/ 这种的很可能不是接口地址，而是没有指定请求的资源名称，服务器会请求默认的资源文件，一般都是index.html/default.html...
  - `DHTML`：动态页面，泛指当前页面中的内容不是写死的而是动态绑定的，例如.jsp/.php/.aspx...这些页面中的数据都是基于AJAX或者是后台编程语言处理，由服务器端渲染，最后把渲染后的结果返回给客户端呈现的
- 参数
  - 问号传参及哈希值`[?xxx=xxx&...\#xxx]` `[?name=xxx&age=25#teacher]`
  - 在HTTP事务中，问号传参是客户端把信息传递给服务器的一种方式(也有可能是跳转到某一个页面，把参数值传递给页面用来标识的)
  - 哈希值一般都跟客户端服务器交互没啥关系，主要用于页面中的锚点定位和HASH路由切换

## HTTP请求阶段：向服务器发送请求 

### DNS域名解析 

> 通过浏览器解析 URL 并生成 HTTP 消息后，需要将消息发送给 Web 服务器。

但在发送之前，还有一项工作需要完成，那就是查询服务器域名对应的 IP 地址

有一种服务器就专门保存了 Web 服务器域名与 IP 的对应关系，它就是 DNS 服务器

> 域名的层级关系  

DNS 中的域名都是用句点来分隔的，比如`www.baidu.com`这里的句点代表了不同层次之间的界限。

在域名中，越靠右的位置表示其层级越高。实际上域名最后还有一个点，比如`www.baidu.com.`
这个最后的一个点代表根域名。

根域的 DNS 服务器信息保存在互联网中所有的 DNS 服务器中

也就是，. 根域是在最顶层，它的下一层就是 .com 顶级域，再下面是 baidu.com。

所以域名的层级关系类似一个树状结构：
![DNS 树状结构](dnsxiaolin.webp)

> 域名解析的工作流程  

- 缓存查询(浏览器缓存、操作系统缓存、hosts文件、路由器DNS缓存)
- 本地DNS服务器（也就是客户端的 TCP/IP 设置中填写的 DNS 服务器地址）
- 当本地DNS服务器接到客户端请求时，首先在该服务器管理的区域的记录中查找，如果找到该记录，则利用此记录进行解析；如果没有区域信息可以满足查询要求，服务器在本地的缓存中查找
- 如果本地DNS服务器不能在本地找到客户端查询的信息，本地DNS服务器将请求发送到根域名DNS服务器(根域名服务器是最高层次的，它不直接用于域名解析)
- 根域名服务器负责解析客户端请求的根域部分，它将包含下一级域名信息的DNS服务器地址返回给客户端的DNS服务器
- 客户端的DNS服务器利用根域名服务器返回的地址访问下一级DNS服务器，得到再下一级域的DNS服务器
- 按照上述递归方法逐级接近查询目标，最后在有目标域名的DNS服务器上找到相应IP地址信息
- 客户端的本地DNS服务器将递归查询结果返回客户端
- 客户端利用从本地DNS服务器查询得到的IP访问目标主机，客户端和目标建立链接

![DNS 解析流程](dnsJXxiaolin.jpg)

